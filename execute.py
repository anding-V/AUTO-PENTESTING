from menu import displayHeader, displayMenu, SubMenu1,SubMenu2,SubMenu3,SubMenu4,SubMenu5,MarkEnd,clear_terminal #CheckIP
from colorama import Fore, Back, Style, init
from functions.whoisSub1 import whois_query
from functions.dnsSub1 import get_ns_lookup
from functions.VulnScan import scan_vuln
from functions.portscan import portscan
from functions.hostdiscovery import discover_hosts
from functions.Localwebscan import scanlocalweb
from functions.Enumsubdomain import subdomenum
from functions.hostdiscovery import exechostdicover
from functions.Servicediscovery import Execservicedis
from functions.Osdiscovery import Os_discovery
from functions.Udpscan import scan_udp
from functions.Webvulnscan1 import Webvulscan1, generate_pdf
from functions.Webvulnscan2 import initWebvulnscan
from functions.ExploitFtp import exploit_ftp
from functions.Enumpasswpolicy import get_password_policy
from functions.Enum1 import  Exec_enum
from functions.massvulnsnip import exec_auto_pentest
from functions import ScanMalware #import Exec_malware_scan

if __name__ == "__main__":

    init()
    displayHeader()
    displayMenu()


    while True:
        option = (input(">>> Choose an option\n>>> "))

        if option.lower() == 'clear':
            clear_terminal()
            displayHeader()
            displayMenu()
            continue

        try:
            option =int(option)           #int(input(">>> Choose an option\n>>> "))
            if not (0 <= option <= 8):
                raise ValueError

        except ValueError:
            print(f'{Fore.RED}WRONG OPTION NUMBER! PLEASE ENTER AN INTEGER BETWEEN 1 AND 8{Style.RESET_ALL}')
            displayMenu()
            continue

        if option == 1:
            while True:
                SubMenu1()
                subOption = input(">>> Choose an option\n>>> ")

                if subOption.lower() == 'clear':
                    clear_terminal()
                    displayHeader()
                    #SubMenu1()
                    continue

                if subOption == '1':
                    domain = input(">>> Type a domain name\n>>> ")
                    print(whois_query(domain))

                elif subOption == '2':
                    get_ns_lookup()

                elif subOption == '3':
                    print("Hi! You can enter an IP address, a hostname, URL, or domain")
                    num_targets = int(input("Enter the number of targets: "))
                    targets = []
                    for _ in range(num_targets):
                        target = input("Enter the target: ")
                        targets.append(target)
                    scanlocalweb(targets)



                    #call fonction for  option c

                #elif subOption == 'd':

                elif subOption == '0':
                    displayMenu()
                    break  # Exit the submenu loop

        elif option == 2:
            while True:
                SubMenu2()
                subOption = input(">>> Choose an option\n>>> ")

                if subOption.lower() == 'clear':
                    clear_terminal()
                    displayHeader()
                    #SubMenu2()
                    continue

                if subOption == '1':
                    exechostdicover()
                if subOption == '2':
                    target = input("Enter the target IP address or hostname: ")
                    portscan(target)
                    print(f"{'-' * 50} SCAN DONE{'-' * 50}")

                if subOption == '3':
                    target = input("Enter the target IP address or hostname: ")
                    Execservicedis(target)
                    print(f"{'-' * 50} SCAN DONE{'-' * 50}")
                if subOption == '4':
                    target = input("Enter the target IP address or hostname: ")
                    #Exec_CheckIP()
                    scan_udp(target)

                    MarkEnd()

                #if subOption == '5':




        #elif subOption == '3':
                   # URL = input(">>> Type target URL (http://example.com/)\n>>> ")
                    #print(f">>> {Fore.GREEN}[+] Starting a dirbuster scan {Style.RESET_ALL}")
                   # url_discover(URL)
                elif subOption == '0':
                    displayMenu()
                    break  # Exit the submenu loop

        # Add elif blocks for options 3, 4, etc.

        elif option == 0:
            print(f'{Fore.BLUE}Thanks for using A.V Toolbox for your Pentesting{Style.RESET_ALL}')
            break  # Exit the main loop


        elif option == 3:
            while True:
                SubMenu3()
                subOption = str(input(">>> Choose an option\n>>> "))

                if subOption.lower() == 'clear':
                    clear_terminal()
                    displayHeader()
                    #SubMenu3()
                    continue

                elif subOption == '1':
                    Exec_enum()

                elif subOption == '2':
                    get_password_policy()
                    """service = str(input(">>> Search for exploits on a service (ex: wordpress 4.0)\n>>> "))
                    exploit = searchsploit(service)
                    print(exploit)"""

                elif subOption == '3':

                    try:
                        target_domain = input("Enter the target domain: ")
                        subdomenum(target_domain)
                    except KeyboardInterrupt:
                        print("\nProgram terminated by user.")
                    except Exception as e:
                        print("An unexpected error occurred:", e)


                elif subOption == '4':
                    target = input("Enter the target IP address or hostname: ")
                    Os_discovery(target)
                    MarkEnd()


                elif subOption == '0':
                    displayMenu()
                    break


        elif option == 4:
            while True:
                SubMenu4()
                subOption = input(">>> Choose an option\n>>> ")

                if subOption.lower() == 'clear':
                    clear_terminal()
                    displayHeader()
                    #SubMenu4()
                    continue

                if subOption == '1':
                    target = input("Enter the target domain or IP address: ")
                    port = input("Enter the port number to scan (press Enter for default): ")

                    # If port is not provided, use default (port 80)
                    if not port:
                        port = "80"
                    print(f"{'-'*50} SCAN STARTED---THIS MAY TAKE SOME TIME{'-'*50}")
                    scan_vuln(target, port)
                elif subOption == '2':
                    host = input("Enter the target IP or domain name: ")
                    port = input("Enter the target port (press Enter for default port 80): ") or "80"
                    output = Webvulscan1(host, port)
                    generate_pdf(output)
                elif subOption == '3':
                    print(f"\n{Fore.BLUE}{'-' * 148}{Style.RESET_ALL}\n\n")
                    initWebvulnscan()
                    print(f"\n\n{Fore.BLUE}{'-' * 49}{Fore.YELLOW}Follow the link and use admin/admin As Credentials{Style.RESET_ALL}{'-' * 49}{Style.RESET_ALL}")

                elif subOption == '4':
                    #target_ip = input("Enter the target IP address: ").strip()
                    #ScanMalware.validate_ip(target_ip)
                    ScanMalware.main()
                    #Exec_malware_scan(target_ip)


                elif subOption == '0':
                    displayMenu()
                    break
        elif option == 5:
            while True:
                SubMenu5()
                subOption = input(">>> Choose an option\n>>> ")

                if subOption.lower() == 'clear':
                    clear_terminal()
                    displayHeader()
                    continue

                if subOption == '1':
                    print(f"{'-' * 50} EXPLOITATION-STARTED---THIS-MAY-TAKE-SOME-TIME{'-' * 50}")
                    exploit_ftp()
                    print(f"{'-' * 50} EXPLOITATION-DONE{'-' * 50}")
                    break

                #elif subOption =='2':
                    #exec_auto_pentest()

                elif subOption =='3':
                    exec_auto_pentest()


                elif subOption == '0':
                    displayMenu()
                    break



                '''if subOption == 'a':
                    user = str(input(">>> Enter a username\n>>> "))
                    usernamecheck = checkusername(user)
                    print(usernamecheck)

                elif subOption == 'b':
                    numberphone = str(input(">>> Enter a phone number in international format (ex: 33969370364)\n>>> "))
                    phone = lookuphone(numberphone)
                    print(phone)

                elif subOption == 'c':
                    local = 'fr_FR'
                    fake_identity = generate_fake_identity(local)
                    print(fake_identity)

                elif subOption == 'd':
                    querys = str(input('>>> Enter a dorks requests (ex: "mommy" filetype:pdf)\n>>> '))
                    dorkquery = dorks(querys)
                    print(dorkquery)


                elif subOption == '0':
                    displayMenu()
                    subOption = str(input(">>> Choose an option\n>>> "))'''

        elif option == 0:
            print(f'{Fore.BLUE}Thanks for using A.V Toolbox for your Pentestsing{Style.RESET_ALL}')
            break

