import subprocess
import os

def nslookup(query_type, target):
    nameserver = "8.8.8.8"  # Utilisez le serveur DNS Google (8.8.8.8) par défaut
    command = f"nslookup -type={query_type} {target} {nameserver}"
    result = subprocess.run(command, shell=True, capture_output=True, text=True)
    return result.stdout

def get_ns_lookup():
    target = input("Entrez un domaine ou une adresse IP : ")
    current_directory = os.getcwd()
    report_directory = os.path.join(current_directory, "rapport")
    os.makedirs(report_directory, exist_ok=True)
    filename = f"dns_result_{target}.txt"
    filepath = os.path.join(report_directory, filename)

    with open(filepath, 'w') as file:
        file.write(f"DNS results for target: {target}\n\n")

        file.write("A Records:\n")
        result = nslookup("A", target)
        file.write(result)
        print(result)
        file.write("\n\n")

        file.write("AAAA Records:\n")
        result = nslookup("AAAA", target)
        file.write(result)
        print(result)
        file.write("\n\n")

        file.write("MX Records:\n")
        result = nslookup("MX", target)
        file.write(result)
        print(result)
        file.write("\n\n")

        file.write("NS Records:\n")
        result = nslookup("NS", target)
        file.write(result)
        print(result)
        file.write("\n\n")

        file.write("CNAME Records:\n")
        result = nslookup("CNAME", target)
        file.write(result)
        print(result)
        file.write("\n\n")

        file.write("PTR Records:\n")
        result = nslookup("PTR", target)
        file.write(result)
        print(result)
        file.write("\n\n")

        file.write("SOA Records:\n")
        result = nslookup("SOA", target)
        file.write(result)
        print(result)
        file.write("\n\n")

        file.write("SRV Records:\n")
        result = nslookup("SRV", target)
        file.write(result)
        print(result)
        file.write("\n\n")

        file.write("SPF Records:\n")
        result = nslookup("SPF", target)
        file.write(result)
        print(result)
        file.write("\n\n")

        file.write("DKIM Records:\n")
        result = nslookup("DKIM", target)
        file.write(result)
        print(result)
        file.write("\n\n")

    print(f"Les résultats de la requête DNS ont été sauvegardés dans '{filename}'.")
    print(f'-------------------------------DNS-LOOKUP-DONE------------------------------')
